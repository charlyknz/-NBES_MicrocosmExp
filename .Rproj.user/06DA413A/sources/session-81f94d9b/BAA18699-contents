### R script to perform TPCs ####

rm(list=ls())#remove all environment data

# packages
library(tidyverse)
library(mgcv) #gam package



#### individual GAM for each species ####

##### Asterio ####
Asterio2 <- read_delim("~/Desktop/phD/Experiments/CharlyTPC2021/Asterio2.csv", 
                                      delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ","), 
                                      trim_ws = TRUE)
  
names(Asterio2)
M1<-gam(r~s(temperature, k=5),data=Asterio2)
summary(M1) # Temperature was significant for all nutrient treatments but 12_1 (seems to be a line)
# for nutrients, only one level (12_2) was different (but reference is always 12-1) 
# Deviance explained 22.5%
anova(M1)

#vis.gam(M1,theta=180,  color = "heat")
#Modell scheint nicht genug Terme zu haben, um etwas Nützliches zu tun
#theta = changes the angle the window is viewed from.
# this plot is not for factors but here it makes sense because the factors are N:P ratios
AIC(M1) # -968
par(mar = c(2, 2, 2, 2))
plot(M1) #Estimated smoothing curve. 
plot(M1, shade = TRUE, pages = 1, scale = 0)

# Predict values: # extract results of model fit for plotting 
pdat <- expand.grid(temperature = seq(0, 38,by=0.1))
pred_r <- predict(M1, newdata = pdat, type = 'response', se=T) 
pdat$r<-pred_r$fit
pdat$se.fit<-pred_r$se.fit
pdat$CI<-pred_r$se.fit*1.96 # no idea what this number means
ggplot()+
  geom_line(data=pdat,aes(x=temperature,y=r))+
  geom_point(data=Asterio2,aes(x=temperature,y=r))+
  scale_y_continuous(limits = c(0,1), breaks = c(0,0.5,1))
max(pdat$r)
pdat[pdat$r==max(pdat$r),1]




####ThalaCux####
ThalaCux <- read_delim("~/Desktop/phD/Experiments/CharlyTPC2021/ThalaCux_noRep.csv", 
                       delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ","), 
                       trim_ws = TRUE)


M02<-gam(r~s(temperature, k=5),data=ThalaCux)
summary(M02) # Temperature was significant for all nutrient treatments but 12_1 (seems to be a line)
# for nutrients, only one level (12_2) was different (but reference is always 12-1) 
# Deviance explained 22.5%
anova(M02)

#vis.gam(M02,theta=180,  color = "heat")
#Modell scheint nicht genug Terme zu haben, um etwas Nützliches zu tun
#theta = changes the angle the window is viewed from.
# this plot is not for factors but here it makes sense because the factors are N:P ratios
AIC(M02) # -968
par(mar = c(2, 2, 2, 2))
plot(M02) #Estimated smoothing curve. 
plot(M02, shade = TRUE, pages = 1, scale = 0)

# Predict values: # extract results of model fit for plotting 
pdat <- expand.grid(temperature = seq(0, 40,by=0.1))
pred_r <- predict(M02, newdata = pdat, type = 'response', se=T) 
pdat$r<-pred_r$fit
pdat$se.fit<-pred_r$se.fit
pdat$CI<-pred_r$se.fit*1.96 # no idea what this number means
ggplot()+
  geom_line(data=pdat,aes(x=temperature,y=r))+
  geom_point(data=ThalaCux,aes(x=temperature,y=r))
max(pdat$r)
pdat[pdat$r==max(pdat$r),1]

#### Dity cux ####
DityCux <- read_delim("~/Desktop/phD/Experiments/CharlyTPC2021/DityCux.csv", 
                       delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ","), 
                       trim_ws = TRUE)

M2<-gam(r~s(temperature, k=5),data=DityCux)
summary(M2) # Temperature was significant for all nutrient treatments but 12_1 (seems to be a line)
# for nutrients, only one level (12_2) was different (but reference is always 12-1) 
# Deviance explained 22.5%
anova(M2)

#vis.gam(M2,theta=180,  color = "heat")
#Modell scheint nicht genug Terme zu haben, um etwas Nützliches zu tun
#theta = changes the angle the window is viewed from.
# this plot is not for factors but here it makes sense because the factors are N:P ratios
AIC(M2) # -968
par(mar = c(2, 2, 2, 2))
plot(M2) #Estimated smoothing curve. 
plot(M2, shade = TRUE, pages = 1, scale = 0)

# Predict values: # extract results of model fit for plotting 
pdat <- expand.grid(temperature = seq(0, 40,by=0.1))
pred_r <- predict(M2, newdata = pdat, type = 'response', se=T) 
pdat$r<-pred_r$fit
pdat$se.fit<-pred_r$se.fit
pdat$CI<-pred_r$se.fit*1.96 # no idea what this number means
ggplot()+
  geom_line(data=pdat,aes(x=temperature,y=r))+
  geom_point(data=DityCux,aes(x=temperature,y=r))
max(pdat$r)
pdat[pdat$r==max(pdat$r),1]


#### Guido ####
Guido <- read_delim("~/Desktop/phD/Experiments/CharlyTPC2021/Guido.csv", 
                      delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ","), 
                      trim_ws = TRUE)

M3<-gam(r~s(temperature, k=5),data=Guido)
summary(M3) # Temperature was significant for all nutrient treatments but 12_1 (seems to be a line)
# for nutrients, only one level (12_2) was different (but reference is always 12-1) 
# Deviance explained 22.5%
anova(M3)

#vis.gam(M3,theta=180,  color = "heat")
#Modell scheint nicht genug Terme zu haben, um etwas Nützliches zu tun
#theta = changes the angle the window is viewed from.
# this plot is not for factors but here it makes sense because the factors are N:P ratios
AIC(M3) # -968
par(mar = c(2, 2, 2, 2))
plot(M3) #Estimated smoothing curve. 
plot(M3, shade = TRUE, pages = 1, scale = 0)

# Predict values: # extract results of model fit for plotting 
pdat <- expand.grid(temperature = seq(0, 40,by=0.1))
pred_r <- predict(M3, newdata = pdat, type = 'response', se=T) 
pdat$r<-pred_r$fit
pdat$se.fit<-pred_r$se.fit
pdat$CI<-pred_r$se.fit*1.96 # no idea what this number means
ggplot()+
  geom_line(data=pdat,aes(x=temperature,y=r))+
  scale_y_continuous(limits = c(0,1.5), breaks = c(0,0.5,1,1.5))+
  geom_point(data=Guido,aes(x=temperature,y=r))
max(pdat$r)
pdat[pdat$r==max(pdat$r),1]


#### Rhizo ####
Rhizo <- read_delim("~/Desktop/phD/Experiments/CharlyTPC2021/Rhizo_rK.csv", 
                    delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ","), 
                    trim_ws = TRUE)

M4<-gam(r~s(temperature, k=5),data=Rhizo)
summary(M4) # Temperature was significant for all nutrient treatments but 12_1 (seems to be a line)
# for nutrients, only one level (12_2) was different (but reference is always 12-1) 
# Deviance explained 22.5%
anova(M4)

#vis.gam(M4,theta=180,  color = "heat")
#Modell scheint nicht genug Terme zu haben, um etwas Nützliches zu tun
#theta = changes the angle the window is viewed from.
# this plot is not for factors but here it makes sense because the factors are N:P ratios
AIC(M4) # -968
par(mar = c(2, 2, 2, 2))
plot(M4) #Estimated smoothing curve. 
plot(M4, shade = TRUE, pages = 1, scale = 0)

# Predict values: # extract results of model fit for plotting 
pdat <- expand.grid(temperature = seq(0, 40,by=0.1))
pred_r <- predict(M4, newdata = pdat, type = 'response', se=T) 
pdat$r<-pred_r$fit
pdat$se.fit<-pred_r$se.fit
pdat$CI<-pred_r$se.fit*1.96 # no idea what this number means
ggplot()+
  geom_line(data=pdat,aes(x=temperature,y=r))+
  scale_y_continuous(limits = c(0,3), breaks = c(0,1.5,3))+
  geom_point(data=Rhizo,aes(x=temperature,y=r))
max(pdat$r)
pdat[pdat$r==max(pdat$r),1]






