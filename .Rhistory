NBESCV <- CV %>%
group_by(temp, N) %>%
mutate(mean_NBES_CV = mean(NBES_CV),
sd_NBES_CV = sd(NBES_CV),
se_NBES_CV=sd_NBES_CV/sqrt(n())) %>%
ggplot(.) +
geom_hline(yintercept = 0)+
geom_point( aes( x = N, y = NBES_CV),color = 'black',  alpha = 0.3)+
geom_point(aes( x = N, y = mean_NBES_CV,color = temp, shape = temp), size = 3)+
geom_errorbar(aes(x= N, y = mean_NBES_CV, ymin = mean_NBES_CV-se_NBES_CV, ymax = mean_NBES_CV+se_NBES_CV,color = temp),width = 0.3, alpha = 0.8)+
facet_wrap(~temp)+
labs(x = 'Species Richness', y=expression(NBES[CV]))+
scale_colour_brewer(palette = "Set1")+
theme_bw()+
theme(legend.position = 'none',
panel.grid.major=element_blank(),panel.grid.minor=element_blank()) +
theme(axis.title.x = element_text(size = 14,face = "plain", colour = "black", vjust = 0),
axis.text.x = element_text(size = 10,  colour = "black", angle = 0, vjust = 0.5)) +
theme(axis.title.y = element_text(size = 14, face = "plain", colour = "black", vjust = 1.8),
axis.text.y = element_text(size = 10,  colour = "black", angle = 0, hjust = 0.4)) +
theme(strip.background =element_rect(),
strip.text.x  = element_text(size = 12))+
guides(color = guide_legend(override.aes = list(size = 3.5)))
NBESCV
plot_grid( NBESresistance,NBESCV,labels = c('(a)', '(b)'), ncol = 1)
ggsave(plot = last_plot(), file = here('output/Fig_NBESmetrics_overall.png'), width = 8, height = 6)
#
#### Explorative plots and analysis ####
### multiple facets cv and resistance ###
##resistance
NBESres1 <- all_resistance  %>%
group_by(temp, N) %>%
summarise(Mean = mean(delta_ges),
sd = sd(delta_ges),
se= sd/sqrt(n()))%>%
ggplot(.) +
geom_hline(yintercept = 0)+
#geom_point( aes( x = N, y = delta_ges), alpha = 0.3)+
geom_point(aes( x = N, y = Mean, color = temp, shape = temp), size = 3)+
geom_errorbar(aes(x= N, y = Mean, ymin = Mean-se, ymax = Mean+se, color = temp), alpha=0.8,width = 0.3)+
#facet_wrap(~temp)+
labs(x = ' ', y=expression(NBES[resistance]))+
scale_colour_brewer(palette = "Set1")+
theme_bw()+
theme(legend.position = 'none',
panel.grid.major=element_blank(),panel.grid.minor=element_blank()) +
theme(axis.title.x = element_text(size = 14,face = "plain", colour = "black", vjust = 0),
axis.text.x = element_text(size = 10,  colour = "black", angle = 0, vjust = 0.5)) +
theme(axis.title.y = element_text(size = 14, face = "plain", colour = "black", vjust = 1.8),
axis.text.y = element_text(size = 10,  colour = "black", angle = 0, hjust = 0.4)) +
theme(strip.background =element_rect(),
strip.text.x  = element_text(size = 12))+
guides(color = guide_legend(override.aes = list(size = 3.5)))
NBESres1
labeln <- c('2'='2 species', '4'='4 species','5'='5 species')
NBESres2 <- all_resistance  %>%
group_by(temp, N,combination) %>%
summarise(Mean = mean(delta_ges),
sd = sd(delta_ges),
se= sd/sqrt(n()))%>%
ggplot(.) +
geom_hline(yintercept = 0)+
#geom_point( aes( x = N, y = delta_ges), alpha = 0.3)+
geom_point(aes( x = combination, y = Mean, color = temp, shape = temp), size = 3)+
geom_errorbar(aes(x= combination, y = Mean, ymin = Mean-se, ymax = Mean+se, color = temp), alpha=0.8,width = 0.3)+
facet_wrap(~N, labeller = labeller(N = labeln), scales = 'free_x')+
labs(x = ' ', y=expression(NBES[resistance]), color = 'Treatment', shape = 'Treatment')+
scale_colour_brewer(palette = "Set1")+
theme_bw()+
theme(legend.position = 'right',
panel.grid.major=element_blank(),panel.grid.minor=element_blank()) +
theme(axis.title.x = element_text(size = 14,face = "plain", colour = "black", vjust = 0),
axis.text.x = element_text(size = 10,  colour = "black", angle = 0, vjust = 0.5)) +
theme(axis.title.y = element_text(size = 14, face = "plain", colour = "black", vjust = 1.8),
axis.text.y = element_text(size = 10,  colour = "black", angle = 0, hjust = 0.4)) +
theme(strip.background =element_rect(),
strip.text.x  = element_text(size = 12))+
guides(color = guide_legend(override.aes = list(size = 3.5)))
# Run
source(here("~/Desktop/Exp22/MicrocosmExp22/code/03_NBE_calculatonNBE.R"))
source(here("~/Desktop/Exp22/MicrocosmExp22/code/05_NBE_HectorLoreau_NetBiodivEffect.R"))
ggsave(plot = last_plot(), file = here('output/FigS1_NBESmetrics_overall.png'), width = 8, height = 6)
plot_grid( NBESresistance,NBESCV,labels = c('(a)', '(b)'), ncol = 1)
ggsave(plot = last_plot(), file = here('output/FigS1_NBESmetrics_overall.png'), width = 8, height = 6)
### required packages ###
library(tidyverse)
library(readxl)
library(lubridate)
library(hms)
library(here)
setwd("~/Desktop/Exp22/Temperature_Charly_Planktotrons_2022")
## import excel files using a Loop
directory <-  paste(getwd(),sep = '') # hier sind meine Daten
#read file (from [here][1])
file.list<- list.files(full.names = TRUE, pattern = "*.xls")
df.list <- lapply(file.list, read_excel)
df <- bind_rows(df.list, .id = "id")
df <- filter(df, !unit %in% c(3, 4,9))
str(df)
setwd("~/Desktop/Exp22/MicrocosmExp22")
#### START ####
df <- read_csv("Data/all_temperatures.csv", locale = locale())
str(df)
temp <- df %>%
mutate(datetime = timestamp) %>%
separate(timestamp, into = c('date', 'time'), sep = ' ') %>%
filter(date > '2022-01-19') %>%
filter(date < '2022-02-18') %>%
mutate(time1 = as.character(time))
dev.off()
# order MC after treatments
tempPalette <- c('black' ,"#E41A1C","#4DAF4A","#377EB8"  ) # temp treatments
dataPlot <- temp%>%
filter( unit %in%c(8,11,2,5)) %>%
mutate(treat = ifelse(unit == 11, 'Constant', ifelse(unit == 2, 'Increase', ifelse(unit == 8, 'Fluctuation', 'Fluctuation + Increase'))))
levels(as.factor(dataPlot$treat))
plot <- ggplot(dataPlot, aes(x = datetime, y = actual_tempmiddle, color = treat))+
geom_line(linewidth = 1.0)+
facet_wrap(~treat,  ncol = 1)+
labs( x = 'Date', y = 'Temperature (in °C)')+
scale_x_datetime(breaks = '7 days')+
scale_color_manual(values = tempPalette)+
theme_classic()+
theme( panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
strip.background = element_blank(),
panel.border= element_rect(colour = "black", fill=NA, size=0.5),
strip.text = element_text(face = 'bold', size = 18),
legend.background = element_blank(),
legend.position  ='none',
legend.key = element_blank())+
theme(axis.title.x = element_text(size = 14,face = "plain", colour = "black", vjust = 0),
axis.text.x = element_text(size = 11,  colour = "black", angle = 0, vjust = 0.5)) +
theme(axis.title.y = element_text(size = 14, face = "plain", colour = "black", vjust = 1.8),
axis.text.y = element_text(size = 11,  colour = "black", angle = 0, hjust = 0.4))
plot
plot <- ggplot(dataPlot, aes(x = datetime, y = actual_tempmiddle, color = treat))+
geom_line(size = 1.0)+
facet_wrap(~treat,  ncol = 1)+
labs( x = 'Date', y = 'Temperature (in °C)')+
scale_x_datetime(breaks = '7 days')+
scale_color_manual(values = tempPalette)+
theme_classic()+
theme( panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
strip.background = element_blank(),
panel.border= element_rect(colour = "black", fill=NA, size=0.5),
strip.text = element_text(face = 'bold', size = 18),
legend.background = element_blank(),
legend.position  ='none',
legend.key = element_blank())+
theme(axis.title.x = element_text(size = 14,face = "plain", colour = "black", vjust = 0),
axis.text.x = element_text(size = 11,  colour = "black", angle = 0, vjust = 0.5)) +
theme(axis.title.y = element_text(size = 14, face = "plain", colour = "black", vjust = 1.8),
axis.text.y = element_text(size = 11,  colour = "black", angle = 0, hjust = 0.4))
plot
ggsave(plot = plot, file = here('output/FigS2_Temp_curves_exp22.png'), height = 12, width = 5)
sessionInfo()
#### NBES: T-test ####
#test against zero
test1 <- t.test(netdiv$NBE, mu = 0, alternative = "two.sided")
library(tidyverse)
library(ggpubr)
# run R scripts
source(here("~/Desktop/Exp22/MicrocosmExp22/code/03_NBE_calculatonNBE.R"))
# run R scripts
source(here("code/03_NBE_calculatonNBE.R"))
# run R scripts
source(here("code/03_NBES_calculation.R"))
str(d3)
netdiv <-d3%>%
mutate(absNBE = abs(NBE))
## check data
summary(netdiv)
names(netdiv)
# combination as factor for analysis
netdiv$combination<-as.factor(netdiv$combination)
#### NBES: ANOVA temp combination ####
aov1<-aov(NBE~temp*combination, netdiv)
summary(aov1)
TukeyHSD(aov1)
ggplot(netdiv, aes(y = NBE, x = as.factor(temp), fill=as.factor(N)))+
geom_boxplot()
# test for normality
hist(netdiv$NBE)
qqnorm(netdiv$NBE)
qqline(netdiv$NBE)
#### NBES: T-test ####
#test against zero
test1 <- t.test(netdiv$NBE, mu = 0, alternative = "two.sided")
test1
tab_model(test1, digits = 3, show.ci = FALSE, file = here("output/NBES_t-test.doc"))
library(sjPlot)
#### NBES: T-test ####
#test against zero
test1 <- t.test(netdiv$NBE, mu = 0, alternative = "two.sided")
test1
tab_model(test1, digits = 3, show.ci = FALSE, file = here("output/NBES_t-test.doc"))
tab_model(aov1, digits = 3, show.ci = FALSE, file = here("output/NBES_aov.doc"))
?tab_model
tab_model(aov1, digits = 3, show.df=T, show.est = T, show.stat =T,show.ci = FALSE, file = here("output/NBES_aov.doc"))
tab_model(aov1, digits = 3, show.df=T, show.est = T, show.stat =T,show.ci = FALSE, file = here("output/NBES_aov.doc"))
tab_model(aov1, digits = 2, show.df=T, show.est = T, show.stat =T,show.ci = FALSE, file = here("output/NBES_aov.doc"))
tab_model(aov1, digits = 3, show.df=T, show.est = T, show.stat =T,show.ci = FALSE, file = here("output/NBES_aov.doc"))
tab_model(aov1, digits = 2, show.df=T, show.est = T, show.stat =T,show.ci = FALSE, file = here("output/NBES_aov.doc"))
tab_model(test1, digits = 2, show.df=T, show.est = T, show.stat =T,show.ci = FALSE, file = here("output/NBES_t-test.doc"))
combiEffect <- netdiv %>%
mutate(composition = combination) %>%
mutate(A = ifelse(str_detect(combination, 'A'), 1, 0), # for presence 1 for absence 0
D = ifelse(str_detect(combination, 'D'), 1, 0),
G = ifelse(str_detect(combination, 'G'), 1, 0),
R = ifelse(str_detect(combination, 'R'), 1, 0),
T = ifelse(str_detect(combination, 'T'), 1, 0))
fluct <- combiEffect %>% filter(temp == 'Fluctuation')
aov2<-aov(NBE~A+D+G+R+T, fluct)
summary(aov2)
tab_model(aov2, digits = 2, show.df=T, show.est = T, show.stat =T,show.ci = FALSE, file = here("output/NBES_Fluc_pres_abs.doc"))
incfluct <- combiEffect %>% filter(temp == 'IncreaseFluctuation')
aov3<-aov(NBE~A+D+G+R+T, incfluct)
summary(aov3)
tab_model(aov3, digits = 2, show.df=T, show.est = T, show.stat =T,show.ci = FALSE, file = here("output/NBES_IncFluc_pres_abs.doc"))
inc <- combiEffect %>% filter(temp == 'Increase')
aov4<-aov(NBE~A+D+G+R+T, inc)
summary(aov4)
tab_model(aov4, digits = 2, show.df=T, show.est = T, show.stat =T,show.ci = FALSE, file = here("output/NBES_Inc_pres_abs.doc"))
netdiv$con1<-NA
netdiv$con1[netdiv$N==2]<- "A"
netdiv$con1[netdiv$N==4]<- "B"
lm1<-aov(NBE~temp*con1, netdiv)
summary(lm1)
TukeyHSD(lm1)
tab_model(aov2,aov3,aov4, digits = 2, show.df=T, show.est = T, show.stat =T,show.ci = FALSE, file = here("output/NBES_pres_abs.doc"))
tab_model(aov2,aov3,aov4, digits = 2,terms = c('Fluctuation', 'FluctuationIncrease', 'Increase'), show.df=T, show.est = T, show.stat =T,show.ci = FALSE, file = here("output/NBES_pres_abs.doc"))
summary(aov4)
netdiv$con1<-NA
netdiv$con1[netdiv$N==2]<- "A"
netdiv$con1[netdiv$N==4]<- "B"
lm1<-aov(NBE~temp*con1, netdiv)
summary(lm1)
TukeyHSD(lm1)
netdiv$con2<-NA
netdiv$con2[netdiv$N==2]<- "A"
netdiv$con2[netdiv$N==5]<- "B"
lm2<-aov(NBE~temp*con2, netdiv)
summary(lm2)
TukeyHSD(lm2)
netdiv$con3<-NA
netdiv$con3[netdiv$N==4]<-"A"
netdiv$con3[netdiv$N==5]<-"B"
lm3<-aov(NBE~temp*con3, netdiv)
summary(lm3)
tab_model(lm1,lm2,lm3, digits = 2,show.df=T, show.est = T, show.stat =T,show.ci = FALSE, file = here("output/NBES_contrasts.doc"))
tab_model(lm1,lm2,lm3, digits = 2,show.df=T, show.ci = FALSE, file = here("output/NBES_contrasts.doc"))
summary(lm3)
source(here("~/Desktop/Exp22/MicrocosmExp22/code/05_NBE_HectorLoreau_NetBiodivEffect.R"))
nbef <- plot_grid( NBE+theme(legend.position = 'none'),plot245+theme(legend.position = 'none'),legend_f,hjust = -0.05, labels = c('(c)', '(d)'), ncol = 3,rel_widths = c( 2/7,4/7,1/7), rel_heights = c(10,0.2))
nbef <- plot_grid( NBE+theme(legend.position = 'none'),
plot245+theme(legend.position = 'none'),
legend_f,
hjust = -0.05,
labels = c('(c)', '(d)'),
ncol = 3,
rel_widths = c( 2/7,4/7,1/7),
rel_heights = c(10,0.2))
# packages
library(tidyverse)
library(readxl)
library(MESS)
library(here)
library(cowplot)
library(RColorBrewer)
setwd("~/Desktop/Exp22/MicrocosmExp22")
#### import data ####
expData<-read.csv('Data/AllRawData_InclBV.csv') %>%
select(-X) %>%
mutate(cellV_mm_ml=cellVolume/10^9)
names(expData)
#### colors and shapes ####
temp1Palette <- c('black',"#E41A1C" ,"#377EB8" ,"#4DAF4A" )
shape_values <- c(23,16, 17, 15)
# relBV
# relative biomass of species in mixture at t0
RelBV_t0_ <- expData %>%
filter(sampling == 1) %>%
group_by(combination, temp, rep) %>%
mutate(sum = sum(cellV_mm_ml, na.rm = T)) %>%
ungroup() %>%
mutate(relBV = cellV_mm_ml/sum) %>%
select(combination, temp, speciesID, rep, relBV)
names(RelBV_t0_)
# Yoi
# observed biomass of species in mixture and monoculture
counts_duo_tmax_ <- expData %>%
filter(sampling == 15) %>%
filter(species == 'duo') %>%
rename(Yoi = cellV_mm_ml)%>%
select(combination, temp,rep, speciesID, Yoi)
names(counts_duo_tmax_)
# Mi
# biomass of species i at tmax in monoculture
counts_mono_tmax_ <- expData %>%
filter(sampling == 15) %>%
filter(species == 'mono') %>%
rename(Mi = cellV_mm_ml) %>%
select( temp, speciesID, rep,Mi)
names(counts_mono_tmax_)
# NBE
#combine df RelAbund_t0 and OD_counts_tmax
NBE_duo <- left_join(RelBV_t0_,counts_mono_tmax_, by = c( 'temp', 'speciesID', 'rep')) %>%
left_join(., counts_duo_tmax_, by = c( 'temp', 'speciesID', 'combination', 'rep')) %>%
drop_na(Yoi) %>%
drop_na(Mi) %>%
group_by(temp, combination, rep) %>%
mutate(NetEffect = sum(Yoi, na.rm = T)- sum(relBV*Mi)) %>%
group_by(temp, combination) %>%
mutate(N = as.numeric(paste(2)),
# compEffect = N*mean(NetEffect)*mean(Mi),
#selecEffect = N*cov(NetEffect, Mi)
)
#### Plot 2 species ####
temp1Palette <- c('black',"#E41A1C" ,"#377EB8" ,"#4DAF4A" )
unique(NBE_duo$temp)
NBE_duo$temp[NBE_duo$temp=='CS'] <- 'Constant'
NBE_duo$temp[NBE_duo$temp=='fluct'] <- 'Fluctuation'
NBE_duo$temp[NBE_duo$temp=='inc'] <- 'Increase'
NBE_duo$temp[NBE_duo$temp=='inc+fluc'] <- 'IncreaseFluctuation'
# Net effect plot
NBE_duo %>%
group_by(combination,  temp) %>%
summarise(mean.effect = mean(NetEffect, na.rm = T),
sd.effect = sd(NetEffect,na.rm = T),
se.effect = sd.effect/sqrt(n())) %>%
ggplot(., aes(x = combination, y = mean.effect, color = temp, shape = temp))+
geom_hline(yintercept = 0, color ='darkgrey')+
geom_errorbar(aes(ymin = mean.effect - se.effect, ymax = mean.effect + se.effect), width = .2, alpha = .7 )+
geom_point(size = 2)+
scale_color_manual(values= temp1Palette)+
scale_shape_manual(values= shape_values)+
labs(y = 'Net Biodiversity Effect', title = 'Two species in combination', color = 'Treatment', shape = 'Treatment')+
#facet_grid(~temp, scales = 'free_y')+
theme_bw()+
theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank()) +
theme(axis.title.x = element_text(size = 16,face = "plain", colour = "black", vjust = 0),
axis.text.x = element_text(size = 10,  colour = "black", angle = 0, vjust = 0.5)) +
theme(axis.title.y = element_text(size = 16, face = "plain", colour = "black", vjust = 1.8),
axis.text.y = element_text(size = 10,  colour = "black", angle = 0, hjust = 0.4)) +
theme(strip.background =element_rect(),
strip.text.x  = element_text(size = 12))+
guides(color = guide_legend(override.aes = list(size = 3.5)))+
theme(legend.position = 'bottom')
# Yoi
# observed biomass of species in mixture and monoculture
counts_tmax <- expData %>%
filter(sampling == 15) %>%
filter(species%in% c('quattro', 'MIX')) %>%
rename(Yoi = cellV_mm_ml)%>%
select(combination, temp,rep, speciesID, Yoi)
names(counts_tmax)
# Mi
# biomass of species i at tmax in monoculture
names(counts_mono_tmax_)
# NBE
#combine df RelAbund_t0 and OD_counts_tmax
NBE_mix <- left_join(RelBV_t0_,counts_mono_tmax_, by = c( 'temp', 'speciesID', 'rep')) %>%
right_join(., counts_tmax, by = c( 'temp', 'speciesID', 'combination', 'rep')) %>%
drop_na(Yoi) %>%
drop_na(Mi) %>%
group_by(temp, combination, rep) %>%
mutate(NetEffect = sum(Yoi, na.rm = T)- sum(relBV*Mi)) %>%
group_by(temp, combination) %>%
mutate(N = as.numeric(paste(2)),
# compEffect = N*mean(NetEffect)*mean(Mi),
#selecEffect = N*cov(NetEffect, Mi)
)
## adjust labels
unique(NBE_mix$temp)
NBE_mix$temp[NBE_mix$temp=='CS'] <- 'Constant'
NBE_mix$temp[NBE_mix$temp=='fluct'] <- 'Fluctuation'
NBE_mix$temp[NBE_mix$temp=='inc'] <- 'Increase'
NBE_mix$temp[NBE_mix$temp=='inc+fluc'] <- 'IncreaseFluctuation'
NBE_mix$combination[NBE_mix$combination == 'ADGRT'] <- '5spec'
allNetBiodiv <- bind_rows(NBE_duo, NBE_mix)%>%
mutate(N = as.factor(str_length(combination))  ) %>%
distinct(combination, temp, rep, NetEffect, N)
allNetBiodiv$N <- factor(as.factor(allNetBiodiv$N), levels= c( '2','4','5'))
#save df as csv
write.csv(allNetBiodiv, file =  here('Data/NBEonFunctioning.csv'))
NBE<-allNetBiodiv%>%
group_by( temp, N) %>%
summarise(mean.effect = mean(NetEffect, na.rm = T),
sd.effect = sd(NetEffect,na.rm = T),
se.effect = sd.effect/sqrt(n()))%>%
ggplot(., aes(x = N, y = mean.effect,color = temp, shape = temp))+
geom_hline(yintercept = 0, color = 'darkgrey')+
geom_errorbar(aes(ymin = mean.effect - se.effect, ymax = mean.effect +se.effect), width = .2, alpha = .8 )+
geom_point(size = 3, alpha = 1)+
labs(x = 'Species Richness', y = expression(Net~Biodiversity~Effect~on~Functioning), color = 'Treatment', shape = 'Treatment')+
scale_color_manual(values= temp1Palette)+
scale_shape_manual(values= shape_values)+
theme_bw()+
theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank()) +
theme(axis.title.x = element_text(size = 14,face = "plain", colour = "black", vjust = 0),
axis.text.x = element_text(size = 10,  colour = "black", angle = 0, vjust = 0.5)) +
theme(axis.title.y = element_text(size = 14, face = "plain", colour = "black", vjust = 1.8),
axis.text.y = element_text(size = 10,  colour = "black", angle = 0, hjust = 0.4)) +
theme(strip.background =element_rect(),
strip.text.x  = element_text(size = 12))+
guides(color = guide_legend(override.aes = list(size = 3.5)))
NBE
labels_plot245 <- c( '2'='2 species','4'='4 species','5'='5 species')
allNetBiodiv$combination[allNetBiodiv$combination == '5spec'] <- 'ADGRT'
plot245<- allNetBiodiv %>%
group_by( combination, temp, N) %>%
summarise(mean.effect = mean(NetEffect, na.rm = T),
sd.effect = sd(NetEffect,na.rm = T),
se.effect = sd.effect/sqrt(n()))%>%
ggplot(., aes(x = combination, y = mean.effect,color = temp, shape = temp))+
geom_hline(yintercept = 0, color = 'darkgrey')+
geom_errorbar(aes(ymin = mean.effect - se.effect, ymax = mean.effect +se.effect), width = .3, alpha = .7 )+
geom_point(size = 2.5, alpha = 0.9)+
labs(x = 'Species Combination', y = expression(Net~Biodiversity~Effect~on~Functioning), color = 'Treatment', shape = 'Treatment')+
scale_color_manual(values= temp1Palette)+
scale_shape_manual(values= shape_values)+
facet_wrap(~N, scales = 'free_x', labeller = labeller(N = labels_plot245))+
theme_bw()+
theme(panel.grid.major=element_blank(),panel.grid.minor=element_blank()) +
theme(axis.title.x = element_text(size = 14,face = "plain", colour = "black", vjust = 0),
axis.text.x = element_text(size = 10,  colour = "black", angle = 0, vjust = 0.5)) +
theme(axis.title.y = element_text(size = 14, face = "plain", colour = "black", vjust = 1.8),
axis.text.y = element_text(size = 10,  colour = "black", angle = 0, hjust = 0.4)) +
theme(strip.background =element_rect(),
strip.text.x  = element_text(size = 12),
legend.position = 'right')+
guides(color = guide_legend(override.aes = list(size = 3.5)))
plot245
legend_f<- get_legend(plot245)
nbef <- plot_grid( NBE+theme(legend.position = 'none'),
plot245+theme(legend.position = 'none'),
legend_f,
hjust = -0.05,
labels = c('(c)', '(d)'),
ncol = 3,
rel_widths = c( 2/7,4/7,1/7),
rel_heights = c(10,0.2))
nbef <- plot_grid( NBE+theme(legend.position = 'none'),
plot245+theme(legend.position = 'none'),
legend_f,
#hjust = -0.05,
labels = c('(c)', '(d)'),
rel_widths = c( 2/7,4/7))
NBE+theme(legend.position = 'none'),
NBE
plot245
nbef <- plot_grid( NBE+theme(legend.position = 'none'),
plot245+theme(legend.position = 'none'),
legend_f,
labels = c('(c)', '(d)'),
rel_widths = c( 2/7,4/7))
nbef <- cowplot::plot_grid( NBE+theme(legend.position = 'none'),
plot245+theme(legend.position = 'none'),
legend_f,
labels = c('(c)', '(d)'),
rel_widths = c( 2/7,4/7))
nbef <- cowplot::plot_grid( NBE+theme(legend.position = 'none'),
plot245+theme(legend.position = 'none'),
legend_f,
hjust = -0.05,
ncol = 3,
labels = c('(c)', '(d)'),
rel_widths = c( 2/7,4/7,1/7))
source(here("~/Desktop/Exp22/MicrocosmExp22/code/05_NBE_HectorLoreau_NetBiodivEffect.R"))
str(allNetBiodiv)
HectorRaw <- allNetBiodiv
#or
#import as csv
#HectorRaw <- read.csv('Data/NBEonFunctioning.csv') %>%
#  select(-X)
str(HectorRaw)
HectorRaw$combination<-as.factor(HectorRaw$combination)
summary(HectorRaw)
#### NBE on F: ANOVA temp, combination ####
aov1<-aov(NetEffect~temp*combination, HectorRaw)
summary(aov1)
TukeyHSD(aov1)
ggplot(HectorRaw, aes(y = NetEffect, x = as.factor(temp), fill=as.factor(N)))+
geom_boxplot()
#### NBE on F: T-Test ####
#test against zero
test2<-t.test(HectorRaw$NetEffect, mu = 0, alternative = "two.sided")
test2
tab_model(test2, digits = 2, show.df=T, show.est = T, show.stat =T,show.ci = FALSE, file = here("output/NBEonF_t-test.doc"))
tab_model(aov1, digits = 2, show.df=T, show.est = T, show.stat =T,show.ci = FALSE, file = here("output/NBEonF_aov.doc"))
ggplot(HectorRaw, aes(y = NetEffect, x = as.factor(temp), fill=as.factor(N)))+
geom_boxplot()
# test for normality
fligner.test(NetEffect~interaction(temp,combination), HectorRaw)
plot(resid(aov1))
hist(resid(aov1))
hist(((HectorRaw$NetEffect)))
qqnorm(HectorRaw$NetEffect)
#### NBE on F: T-Test ####
#test against zero
test2<-t.test(HectorRaw$NetEffect, mu = 0, alternative = "two.sided")
test2
tab_model(test2, digits = 2, show.df=T, show.est = T, show.stat =T,show.ci = FALSE, file = here("output/NBEonF_t-test.doc"))
#### NBES - NBE on F: Correlation ####
Corr.data <- netdiv %>%
select(combination, temp, rep, NBE, N) %>%
mutate(N = as.factor(N)) %>%
left_join(.,HectorRaw, by = c('combination', 'temp', 'rep', 'N'))
ggscatter(Corr.data, x = 'NetEffect', y='NBE', add = 'reg.line', cor.coef = T, xlab = 'NBE on Functioning', ylab = 'NBES')
ggsave(plot = last_plot(), file = here('output/Correlation_NBE_NBES.png'))
